<!DOCTYPE html>
<html>
<head>
<title>CSS for Org-exported HTML</title>
<!-- 2015-10-23 Fri 16:51 -->
<meta  charset="utf-8">
<meta  name="generator" content="Org-mode">
<meta  name="author" content="Zhitao Gong">
<link rel="stylesheet" type="text/css" href="http://gongzhitaao.org/orgcss/org.css"/>
<link rel="stylesheet" type="text/css" href="org.css"/>
<link rel="stylesheet" type="text/css" href="css/style.css"/>
</head>
<body>
<div id="content">
<h1 class="title">CSS for Org-exported HTML</h1>
<div class="abstract">
<p>
This article shows off my <a href="http:./org.css">org.css</a>, a simple and clean stylesheet for
org-exported HTML file based on <a href="https://necolas.github.io/normalize.css/">normalize.css</a>.  My org template for
blogging is also provided.  However the configuration of blogging with
org mode is omitted for brevity.
</p>

</div>

<nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec:introduction">1. Introduction</a></li>
<li><a href="#sec:motivation">2. Motivation</a></li>
<li><a href="#sec:setup">3. Setup</a>
<ul>
<li><a href="#sec:external-utilities">3.1. External Utilities</a></li>
<li><a href="#sec:org-templates">3.2. Org Templates</a></li>
</ul>
</li>
<li><a href="#sec:known-issues">4. Known Issues</a>
<ul>
<li><a href="#sec:bib-links">4.1. Bib Links</a></li>
<li><a href="#sec:dangling-element">4.2. Dangling Element</a></li>
<li><a href="#sec:bibliograph-in-wrong-section">4.3. Bibliography in Wrong Section</a></li>
<li><a href="#sec:wrong-back-reference">4.4. Wrong Back Reference</a></li>
</ul>
</li>
<li><a href="#sec:conclusion">5. Conclusion</a></li>
</ul>
</div>
</nav>

<div id="outline-container-sec:introduction" class="outline-2">
<h2 id="sec:introduction"><a id="sec-1" name="sec-1"></a><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-sec:introduction">

<blockquote>
<p>
<a href="http://orgmode.org/">Org mode</a> is for keeping notes<sup><a id="fnr.1" name="fnr.1" class="footref" href="#fn.1">1</a></sup>, maintaining TODO lists, planning
projects, and authoring documents with a fast and effective
<i>plain-text</i> system<sup><a id="fnr.2" name="fnr.2" class="footref" href="#fn.2">2</a></sup>.
</p>
</blockquote>

<p>
Org mode is a built-in major mode in <a href="http://www.gnu.org/software/emacs/">Emacs</a>.  It's similar to
<a href="http://daringfireball.net/projects/markdown/syntax">markdown</a> where all editing is done in plain text with some character
markups to decorate texts and finally the text file can be compiled
or exported to some other formats.  The philosophy is that we can
concentrate on the contents with as few distraction from the styles
as possible, i.e., as easy-to-read and easy-to-write as is feasible.
However, markdown is just a markup language for web writers, while
org mode provides much richer functionality beyond simple text
markup.  For a full introduction to org mode, please refer to
<a href="http://orgmode.org/">orgmode.org</a> or Emacs manual.  In this article, we focus on one of
its uses, <i>exporting to html</i>.
</p>

<p>
I will assume that readers are already familiar with Emacs and org
mode.  In Section <a href="#sec:motivation">2</a> I provide the motivation for this
short demo.  All related configuration and templates are detailed in
Section <a href="#sec:setup">3</a>.  And finally Section <a href="#sec:conclusion">5</a> concludes
this article.
</p>
</div>
</div>

<div id="outline-container-sec:motivation" class="outline-2">
<h2 id="sec:motivation"><a id="sec-2" name="sec-2"></a><span class="section-number-2">2</span> Motivation</h2>
<div class="outline-text-2" id="text-sec:motivation">

<p>
As a heavy Emacs user, <a href="https://www.google.com/search?q=blogging+with+org+mode">blogging with org mode</a> is a natural choice.
Since I'm keeping notes and ideas in org mode, and some of them I
may want to publish online.  Questions like why not use products
like MS OneNote or Google Keep or Wordpress or whatever simply boil
down to personal preference.  Org file is a simple text file which
can be processed efficiently by external programs.  It has good
built-in support from Emacs, and can be exported to various formats,
including <i>tex</i>, <i>pdf</i> and <i>html</i>.  Except for some special cases
where dedicated styles are needed, say academic papers, the default
export styles with simple tweaks usually satisfy my needs.  However,
the default style provided by org html exporter is simple <i>boring</i>.
So I decide to tweak the stylesheet a little bit to make it <i>clean</i>,
<i>simple</i> and more <i>eye appealing</i>.
</p>

<p>
Souce code of this file is available at
<a href="https://github.com/gongzhitaao/orgcss">https://github.com/gongzhitaao/orgcss</a>.
</p>
</div>
</div>

<div id="outline-container-sec:setup" class="outline-2">
<h2 id="sec:setup"><a id="sec-3" name="sec-3"></a><span class="section-number-2">3</span> Setup</h2>
<div class="outline-text-2" id="text-sec:setup">

<p>
Publishing with org mode can be achieved as simple as a few
keystrokes (say <kbd>C-c C-e h h</kbd> for html exporting and
<kbd>C-c C-e l p</kbd> for pdf exporting).  We omit the publishing
configuration as the main goal of this article is to demo my
stylesheet.  The process can be meticulously tweaked following the
<a href="http://orgmode.org/manual/Publishing.html#Publishing">instruction here.</a>  Actually in my current setup, no tweaks and
special configurations are needed.  All remains default and works
out of the box.
</p>
</div>

<div id="outline-container-sec:external-utilities" class="outline-3">
<h3 id="sec:external-utilities"><a id="sec-3-1" name="sec-3-1"></a><span class="section-number-3">3.1</span> External Utilities</h3>
<div class="outline-text-3" id="text-sec:external-utilities">

<p>
Table <a href="#tab:util">1</a> list all the external utilities I used for
publishing and rendering.
</p>

<table id="tab:util">
<caption class="t-above"><span class="table-number">Table 1:</span> Utilities</caption>

<colgroup>
<col  class="left">

<col  class="left">
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Utility</th>
<th scope="col" class="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left"><a href="https://www.lri.fr/~filliatr/bibtex2html/">bibtex2html</a></td>
<td class="left">Export citations in bib files, if any, to html.</td>
</tr>

<tr>
<td class="left"><a href="https://www.mathjax.org/">MathJax</a></td>
<td class="left">Render math equations.</td>
</tr>
</tbody>
</table>

<p>
Here are some notes about the above utility.
</p>

<ul class="org-ul">
<li>Bibtex2html is optional if no citation is required.  Citation
syntax is the same as in <span class="latex">L<sup>a</sup>T<sub>e</sub>X</span>, i.e., <code>\cite{key}</code>.  To
use this functionality, you should include the following elisp
code in your org configuration.

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">require</span> '<span style="color: #73d216;">ox-bibtex</span>)
</pre>
</div>
</li>

<li>I use <a href="https://www.mathjax.org/">MathJax</a> inline rendering for equations despite of its
speed.  It is rumored that <a href="http://khan.github.io/KaTeX/">KaTeX</a> loads and renders much faster
than MathJax, but the latter supports only a subset of
<span class="latex">L<sup>a</sup>T<sub>e</sub>X</span> syntax.  See the <a href="http://www.intmath.com/cg5/katex-mathjax-comparison.php">comparison</a> between the two.
Anyway, I do not have that many equations to show off.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec:org-templates" class="outline-3">
<h3 id="sec:org-templates"><a id="sec-3-2" name="sec-3-2"></a><span class="section-number-3">3.2</span> Org Templates</h3>
<div class="outline-text-3" id="text-sec:org-templates">

<p>
The following is my org file template for blogging.
</p>

<div class="org-src-container">

<pre class="src src-org"><span style="color: #babdb6;">#+TITLE:</span> <span style="color: #729fcf; font-size: 140%; font-weight: bold;">Article Title Goes Here</span>
<span style="color: #babdb6; font-style: italic;">#+OPTIONS: toc:nil num:t tex:dvipng</span>
<span style="color: #babdb6; font-style: italic;">#+HTML_HEAD: &lt;link rel="stylesheet" type="text/css" href="css/normalize.css"/&gt;</span>
<span style="color: #babdb6; font-style: italic;">#+HTML_HEAD: &lt;link rel="stylesheet" type="text/css" href="org.css"/&gt;</span>

<span style="color: #babdb6; font-style: italic;"># Separate the title with the content</span>
-----

<span style="color: #babdb6; font-style: italic;">#+BEGIN_ABSTRACT</span>
Article abstract goes here.
<span style="color: #babdb6; font-style: italic;">#+END_ABSTRACT</span>

<span style="color: #babdb6; font-style: italic;"># now prints out the previously disabled (toc:nil) table of contents.</span>
<span style="color: #babdb6; font-style: italic;">#+TOC: headlines 3</span>

Your content goes here.

<span style="color: #babdb6; font-style: italic;"># separate the body with the footnotes and reference</span>
-----

<span style="color: #babdb6; font-style: italic;"># prints out bibliograph, if any, with bibtex2html.  The first</span>
<span style="color: #babdb6; font-style: italic;"># parameter is the bibliograph file name without .bib extension, the</span>
<span style="color: #babdb6; font-style: italic;"># second is the reference style.</span>
<span style="color: #babdb6; font-style: italic;">#+BIBLIOGRAPHY: bib-file plain</span>

<span style="color: #babdb6; font-style: italic;"># This is an automatically generated section is you use footnote.</span>
<span style="color: #729fcf; font-size: 130%; font-weight: bold;">* Footnotes</span>
</pre>
</div>

<p>
With all these setup, only one thing is left, i.e., tweaking the
styles of exported html.  By default, The HTML exporter assigns
some <a href="http://orgmode.org/manual/CSS-support.html">special CSS classes</a> to appropriate parts of the document and
your style specifications may change these, in addition to any of
the standard classes like for headlines, tables, etc.  The list is
actually not complete, you may want to export a test org file and
read the source of exported html file to find out what classes are
available.  The current page shows off my org.css.  Some other good
styles for org-exported html can be found on <a href="http://orgmode.org/">http://orgmode.org/</a>,
<a href="http://doc.norang.ca/org-mode.html">http://doc.norang.ca/org-mode.html</a> and etc.
</p>
</div>
</div>
</div>

<div id="outline-container-sec:known-issues" class="outline-2">
<h2 id="sec:known-issues"><a id="sec-4" name="sec-4"></a><span class="section-number-2">4</span> Known Issues</h2>
<div class="outline-text-2" id="text-sec:known-issues">

<p>
The citation exporter, <code>ox-bibtex</code>, does NOT work seamlessly.  As of
<code>Org-mode version 8.2.10</code>, I have the following issues.
</p>
</div>

<div id="outline-container-sec:bib-links" class="outline-3">
<h3 id="sec:bib-links"><a id="sec-4-1" name="sec-4-1"></a><span class="section-number-3">4.1</span> Bib Links</h3>
<div class="outline-text-3" id="text-sec:bib-links">

<p>
For ref.bib, <code>bibtex2html</code> generates two files, ref.html and
ref_bib.html.  Links in the two files are redirected to each other.
For example, the bib link in ref_bib.html links to appropriate
section in ref.html and key in ref.html links back to ref_bib.html.
<code>ox-bibtex</code> ignores this and copies the content of ref.html directly
to the exported html file.  So here comes the problem.  In the
exported html, everything works fine but when you try to go and see
the bib source of a citation, you will be directed to ref_bib.html,
and then when you try to get back from ref_bib.html by the key, you
get directed to ref.html instead of the generated
document. Currently there is no elegant solution yet except hacking
some code to post-process the generated document.
</p>
</div>
</div>

<div id="outline-container-sec:dangling-element" class="outline-3">
<h3 id="sec:dangling-element"><a id="sec-4-2" name="sec-4-2"></a><span class="section-number-3">4.2</span> Dangling Element</h3>
<div class="outline-text-3" id="text-sec:dangling-element">
<p>
The lisp function <code>insert-file-contents</code> used in <code>ox-bibtex</code> does
not move point and insertion-marker to the end of inserted text
(I'm not sure it is a bug or an intention).  The result is that the
citation is a dangling table not included in the bibliography div.
</p>

<p>
The expected result is
</p>

<div class="org-src-container">

<pre class="src src-html">&lt;<span style="color: #fcaf3e; font-weight: bold;">div</span> <span style="color: #ff2929;">id</span>=<span style="color: #de7fa8;">"bibliography"</span>&gt;
  &lt;<span style="color: #fcaf3e; font-weight: bold;">h2</span>&gt;<span style="font-weight: bold; font-style: italic; text-decoration: underline;">Bibliography</span>&lt;/<span style="color: #fcaf3e; font-weight: bold;">h2</span>&gt;
  &lt;<span style="color: #fcaf3e; font-weight: bold;">table</span>&gt;
  <span style="color: #babdb6; font-style: italic;">&lt;!-- </span><span style="color: #babdb6; font-style: italic;">Citation content goes here </span><span style="color: #babdb6; font-style: italic;">--&gt;</span>
  &lt;/<span style="color: #fcaf3e; font-weight: bold;">table</span>&gt;
&lt;/<span style="color: #fcaf3e; font-weight: bold;">div</span>&gt;
</pre>
</div>

<p>
But we got
</p>

<div class="org-src-container">

<pre class="src src-html">&lt;<span style="color: #fcaf3e; font-weight: bold;">div</span> <span style="color: #ff2929;">id</span>=<span style="color: #de7fa8;">"bibliography"</span>&gt;
  &lt;<span style="color: #fcaf3e; font-weight: bold;">h2</span>&gt;<span style="font-weight: bold; font-style: italic; text-decoration: underline;">Bibliography</span>&lt;/<span style="color: #fcaf3e; font-weight: bold;">h2</span>&gt;
&lt;/<span style="color: #fcaf3e; font-weight: bold;">div</span>&gt;
&lt;<span style="color: #fcaf3e; font-weight: bold;">table</span>&gt;
<span style="color: #babdb6; font-style: italic;">&lt;!-- </span><span style="color: #babdb6; font-style: italic;">Citation content goes here </span><span style="color: #babdb6; font-style: italic;">--&gt;</span>
&lt;/<span style="color: #fcaf3e; font-weight: bold;">table</span>&gt;
</pre>
</div>

<p>
Unless a patch is submitted, we may need to manually adjust this
weird result.
</p>
</div>
</div>

<div id="outline-container-sec:bibliograph-in-wrong-section" class="outline-3">
<h3 id="sec:bibliograph-in-wrong-section"><a id="sec-4-3" name="sec-4-3"></a><span class="section-number-3">4.3</span> Bibliography in Wrong Section</h3>
<div class="outline-text-3" id="text-sec:bibliograph-in-wrong-section">

<p>
The exported bibliography is always included in some other section
div instead of a stand-lone section.
</p>

<p>
The expected result is
</p>

<div class="org-src-container">

<pre class="src src-html">&lt;<span style="color: #fcaf3e; font-weight: bold;">div</span> <span style="color: #ff2929;">id</span>=<span style="color: #de7fa8;">"outline-container-1"</span> <span style="color: #ff2929;">class</span>=<span style="color: #de7fa8;">"outline-2"</span>&gt;
<span style="color: #babdb6; font-style: italic;">&lt;!-- </span><span style="color: #babdb6; font-style: italic;">section 1 </span><span style="color: #babdb6; font-style: italic;">--&gt;</span>
&lt;<span style="color: #fcaf3e; font-weight: bold;">div</span>&gt;
&lt;<span style="color: #fcaf3e; font-weight: bold;">div</span> <span style="color: #ff2929;">id</span>=<span style="color: #de7fa8;">"outline-container-2"</span> <span style="color: #ff2929;">class</span>=<span style="color: #de7fa8;">"outline-2"</span>&gt;
<span style="color: #babdb6; font-style: italic;">&lt;!-- </span><span style="color: #babdb6; font-style: italic;">section 2 </span><span style="color: #babdb6; font-style: italic;">--&gt;</span>
&lt;<span style="color: #fcaf3e; font-weight: bold;">div</span>&gt;
&lt;<span style="color: #fcaf3e; font-weight: bold;">div</span> <span style="color: #ff2929;">id</span>=<span style="color: #de7fa8;">"outline-container-3"</span> <span style="color: #ff2929;">class</span>=<span style="color: #de7fa8;">"outline-2"</span>&gt;
<span style="color: #babdb6; font-style: italic;">&lt;!-- </span><span style="color: #babdb6; font-style: italic;">section 3 </span><span style="color: #babdb6; font-style: italic;">--&gt;</span>
&lt;<span style="color: #fcaf3e; font-weight: bold;">div</span>&gt;
&lt;<span style="color: #fcaf3e; font-weight: bold;">div</span> <span style="color: #ff2929;">id</span>=<span style="color: #de7fa8;">"bibliography"</span>&gt;
<span style="color: #babdb6; font-style: italic;">&lt;!-- </span><span style="color: #babdb6; font-style: italic;">bibliography goes here </span><span style="color: #babdb6; font-style: italic;">--&gt;</span>
&lt;<span style="color: #fcaf3e; font-weight: bold;">div</span>&gt;
</pre>
</div>

<p>
But we got
</p>

<div class="org-src-container">

<pre class="src src-html">&lt;<span style="color: #fcaf3e; font-weight: bold;">div</span> <span style="color: #ff2929;">id</span>=<span style="color: #de7fa8;">"outline-container-1"</span> <span style="color: #ff2929;">class</span>=<span style="color: #de7fa8;">"outline-2"</span>&gt;
<span style="color: #babdb6; font-style: italic;">&lt;!-- </span><span style="color: #babdb6; font-style: italic;">section 1 </span><span style="color: #babdb6; font-style: italic;">--&gt;</span>
&lt;<span style="color: #fcaf3e; font-weight: bold;">div</span>&gt;
&lt;<span style="color: #fcaf3e; font-weight: bold;">div</span> <span style="color: #ff2929;">id</span>=<span style="color: #de7fa8;">"outline-container-2"</span> <span style="color: #ff2929;">class</span>=<span style="color: #de7fa8;">"outline-2"</span>&gt;
<span style="color: #babdb6; font-style: italic;">&lt;!-- </span><span style="color: #babdb6; font-style: italic;">section 2 </span><span style="color: #babdb6; font-style: italic;">--&gt;</span>
&lt;<span style="color: #fcaf3e; font-weight: bold;">div</span>&gt;
&lt;<span style="color: #fcaf3e; font-weight: bold;">div</span> <span style="color: #ff2929;">id</span>=<span style="color: #de7fa8;">"outline-container-3"</span> <span style="color: #ff2929;">class</span>=<span style="color: #de7fa8;">"outline-2"</span>&gt;
<span style="color: #babdb6; font-style: italic;">&lt;!-- </span><span style="color: #babdb6; font-style: italic;">section 3 </span><span style="color: #babdb6; font-style: italic;">--&gt;</span>
  &lt;<span style="color: #fcaf3e; font-weight: bold;">div</span> <span style="color: #ff2929;">id</span>=<span style="color: #de7fa8;">"bibliography"</span>&gt;
  <span style="color: #babdb6; font-style: italic;">&lt;!-- </span><span style="color: #babdb6; font-style: italic;">bibliography goes here </span><span style="color: #babdb6; font-style: italic;">--&gt;</span>
  &lt;<span style="color: #fcaf3e; font-weight: bold;">div</span>&gt;
&lt;<span style="color: #fcaf3e; font-weight: bold;">div</span>&gt;
</pre>
</div>

<p>
The problem is that the following command
</p>

<div class="org-src-container">

<pre class="src src-org"><span style="color: #babdb6; font-style: italic;">#+BIBLIOGRAPHY ref plain</span>
</pre>
</div>

<p>
is always ignored unless it is belonged to a section.  This is due
to the internal implementation of keyword parser of <code>ox-html</code>.
Currently hacking some post-processing code is the only solution if
you do not want to do it manually.
</p>
</div>
</div>

<div id="outline-container-sec:wrong-back-reference" class="outline-3">
<h3 id="sec:wrong-back-reference"><a id="sec-4-4" name="sec-4-4"></a><span class="section-number-3">4.4</span> Wrong Back Reference</h3>
<div class="outline-text-3" id="text-sec:wrong-back-reference">

<p>
The links generated by <code>ox-bibtex</code> is also troublesome.  Given
<code>ref.bib</code>, <code>bibtex2html</code> will generate two files, <code>reb_bib.html</code>
and <code>ref.html</code>.  The utility <code>ox-bibtex</code> directly inserts contents
of <code>ref.html</code> to the current exported html.  Now when you click
links in the exported html, you will be directed to <code>ref_bib.html</code>.
And when expecting to get back to the exported html by clicking
links in <code>ref_bib.html</code>, you will be instead directed to
<code>ref.html</code>.  It is not a big deal, but just annoying.  I would
use links instead of citations whenever possible.
</p>
</div>
</div>
</div>

<div id="outline-container-sec:conclusion" class="outline-2">
<h2 id="sec:conclusion"><a id="sec-5" name="sec-5"></a><span class="section-number-2">5</span> Conclusion</h2>
<div class="outline-text-2" id="text-sec:conclusion">

<p>
This article essentially demonstrates my stylesheet for org-exported
html file without going into details about the publishing process
which requires some knowledge about Emacs and org mode.  There are
some dangling issues around the citation with <code>ox-bibtex</code>, to which
the simple solution is to use links instead of citations, if
possible.  Otherwise, hacking some post-processing code is
necessary.
</p>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" name="fn.1" class="footnum" href="#fnr.1">1</a></sup> <p class="footpara">
For note keeping, <a href="http://jblevins.org/projects/deft/">Deft</a> with Orgmode make a cute couple.
</p></div>

<div class="footdef"><sup><a id="fn.2" name="fn.2" class="footnum" href="#fnr.2">2</a></sup> <p class="footpara">
A <a href="http://doc.norang.ca/org-mode.html">great article</a> elaborates on this.
</p></div>


</div>
</div></div>
<div id="postamble" class="status">
<a class="author"
         href="http://gongzhitaao.org">Zhitao Gong</a> / <span
         class="date">2015-10-23 Fri 16:51</span><span class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.5.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</span>
</div>
</body>
</html>
